---
import { client, queries } from '../lib/sanity';
import type { SanitySiteSettings } from '../lib/sanity';

const defaultNavLinks = [
  { href: '/', label: 'Úvod' },
  { href: '/o-mne', label: 'O mně' },
  { href: '/sluzby', label: 'Služby' },
  { href: '/nemovitosti', label: 'Nemovitosti' },
  { href: '/zrealizovano', label: 'Zrealizováno' },
  { href: '/reference', label: 'Reference' },
  { href: '/kontakt', label: 'Kontakt' },
];

let siteSettings: SanitySiteSettings | null = null;
try {
  siteSettings = await client.fetch<SanitySiteSettings>(queries.siteSettings);
} catch (_) {}

const siteName = siteSettings?.siteName || 'Tomáš Menšík';
const navLinks = (siteSettings?.navLinks?.length ? siteSettings.navLinks.filter((l) => l.href && l.label).map((l) => ({ href: l.href!, label: l.label! })) : null) ?? defaultNavLinks;
const currentPath = Astro.url.pathname;
---

<header class="fixed top-0 left-0 right-0 z-50 bg-sand-50/95 backdrop-blur-sm border-b border-sand-200/50">
  <nav class="container-narrow">
    <div class="flex items-center justify-between h-20">
      <a href="/" class="font-heading text-2xl font-semibold text-sand-900 tracking-wide">
        {siteName}
      </a>

      <!-- Desktop Navigation -->
      <ul class="hidden lg:flex items-center gap-8">
        {navLinks.map((link) => (
          <li>
            <a
              href={link.href}
              class:list={[
                'text-sm font-medium tracking-wide transition-colors duration-300',
                currentPath === link.href
                  ? 'text-accent-700'
                  : 'text-sand-700 hover:text-accent-700'
              ]}
            >
              {link.label}
            </a>
          </li>
        ))}
      </ul>

      <!-- Mobile Menu Button -->
      <button
        id="mobile-menu-btn"
        class="lg:hidden p-2 text-sand-700 hover:text-sand-900 transition-colors"
        aria-label="Otevřít menu"
        aria-expanded="false"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path id="menu-icon" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </div>
  </nav>

  <!-- Mobile Menu -->
  <div id="mobile-menu" class="lg:hidden hidden bg-sand-50 border-t border-sand-200">
    <ul class="container-narrow py-6 space-y-4">
      {navLinks.map((link) => (
        <li>
          <a
            href={link.href}
            class:list={[
              'block py-2 text-lg font-medium transition-colors',
              currentPath === link.href
                ? 'text-accent-700'
                : 'text-sand-700 hover:text-accent-700'
            ]}
          >
            {link.label}
          </a>
        </li>
      ))}
    </ul>
  </div>
</header>

<!-- Spacer for fixed header -->
<div class="h-20"></div>

<script>
  const menuBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuIcon = document.getElementById('menu-icon');

  menuBtn?.addEventListener('click', () => {
    const isExpanded = menuBtn.getAttribute('aria-expanded') === 'true';
    menuBtn.setAttribute('aria-expanded', (!isExpanded).toString());
    mobileMenu?.classList.toggle('hidden');
    
    // Toggle icon between hamburger and X
    if (isExpanded) {
      menuIcon?.setAttribute('d', 'M4 6h16M4 12h16M4 18h16');
    } else {
      menuIcon?.setAttribute('d', 'M6 18L18 6M6 6l12 12');
    }
  });
</script>
