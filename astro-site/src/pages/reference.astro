---
import Layout from '../layouts/Layout.astro';
import { client, queries, getServiceTypeLabel } from '../lib/sanity';
import type { SanityTestimonial } from '../lib/sanity';

// Fetch testimonials from Sanity with error handling
let testimonials: SanityTestimonial[] = [];
try {
  testimonials = await client.fetch<SanityTestimonial[]>(queries.allTestimonials) || [];
} catch (error) {
  console.error('Error fetching testimonials:', error);
  testimonials = [];
}

// Stats
const avgRating = '4.9';
const totalReviews = testimonials.length + 87;
---

<Layout title="Reference" description="Co říkají klienti o spolupráci s Tomášem Menšíkem. Přečtěte si reference spokojených zákazníků.">
  <!-- Hero -->
  <section class="py-20 bg-sand-100">
    <div class="container-narrow">
      <div class="max-w-3xl">
        <p class="text-accent-700 font-medium tracking-widest uppercase text-sm mb-4 animate-fade-in">
          Reference
        </p>
        <h1 class="font-heading text-5xl md:text-6xl text-sand-900 mb-6 animate-fade-in animate-delay-100">
          Co říkají klienti
        </h1>
        <p class="text-sand-600 text-xl animate-fade-in animate-delay-200">
          Přečtěte si, jaké zkušenosti mají se mnou moji klienti. 
          Vaše spokojenost je pro mě na prvním místě.
        </p>
      </div>
    </div>
  </section>

  <!-- Stats -->
  <section class="py-12 bg-white border-b border-sand-200">
    <div class="container-narrow">
      <div class="flex flex-wrap items-center justify-center gap-12">
        <div class="flex items-center gap-3">
          <div class="flex">
            {[1, 2, 3, 4, 5].map((star) => (
              <svg class="w-6 h-6 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
              </svg>
            ))}
          </div>
          <div>
            <span class="font-heading text-2xl text-sand-900 font-semibold">{avgRating}</span>
            <span class="text-sand-500 text-sm ml-1">/ 5</span>
          </div>
        </div>
        <div class="h-12 w-px bg-sand-200 hidden md:block"></div>
        <div class="text-center">
          <span class="font-heading text-2xl text-sand-900 font-semibold">{totalReviews}+</span>
          <span class="text-sand-500 text-sm ml-2">spokojených klientů</span>
        </div>
        <div class="h-12 w-px bg-sand-200 hidden md:block"></div>
        <div class="text-center">
          <span class="font-heading text-2xl text-sand-900 font-semibold">100%</span>
          <span class="text-sand-500 text-sm ml-2">doporučení</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Testimonials Grid -->
  <section class="py-20">
    <div class="container-narrow">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        {testimonials.length > 0 ? testimonials.map((testimonial, index) => (
          <div 
            class="bg-white border border-sand-200 p-8 hover:border-accent-300 hover:shadow-lg transition-all duration-300 animate-fade-in"
            style={`animation-delay: ${index * 100}ms`}
          >
            <!-- Quote icon -->
            <svg class="w-10 h-10 text-accent-200 mb-4" fill="currentColor" viewBox="0 0 24 24">
              <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h4v10h-10z" />
            </svg>

            <!-- Text -->
            <p class="text-sand-700 leading-relaxed mb-6">
              "{testimonial.text}"
            </p>

            <!-- Author -->
            <div class="flex items-center justify-between">
              <div>
                <p class="font-medium text-sand-900">{testimonial.clientName}</p>
                {testimonial.location && (
                  <p class="text-sm text-sand-500">{testimonial.location}</p>
                )}
              </div>
              <div class="text-right">
                {testimonial.serviceType && (
                  <span class="inline-block px-3 py-1 bg-accent-100 text-accent-800 text-xs font-medium">
                    {getServiceTypeLabel(testimonial.serviceType)}
                  </span>
                )}
                {testimonial.date && (
                  <p class="text-sm text-sand-400 mt-1">{testimonial.date}</p>
                )}
              </div>
            </div>
          </div>
        )) : (
          <div class="col-span-2 text-center py-12">
            <p class="text-sand-500 text-lg">Reference budou brzy přidány.</p>
          </div>
        )}
      </div>
    </div>
  </section>

  <!-- CTA -->
  <section class="py-20 bg-sand-100">
    <div class="container-narrow">
      <div class="bg-white p-8 md:p-12 text-center">
        <h2 class="font-heading text-3xl md:text-4xl text-sand-900 mb-4">
          Připojte se ke spokojeným klientům
        </h2>
        <p class="text-sand-600 max-w-2xl mx-auto mb-8">
          Ať už chcete prodat, koupit nebo ocenit nemovitost, rád vám pomohu. 
          Kontaktujte mě pro nezávaznou konzultaci.
        </p>
        <div class="flex flex-wrap justify-center gap-4">
          <a href="/kontakt" class="btn btn-primary">
            Kontaktovat mě
          </a>
          <a href="/nemovitosti" class="btn btn-outline">
            Prohlédnout nabídku
          </a>
        </div>
      </div>
    </div>
  </section>
</Layout>

<style>
  .animate-fade-in {
    opacity: 0;
    animation: fadeIn 0.6s ease-out forwards;
  }
</style>
